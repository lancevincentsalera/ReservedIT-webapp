@model ASI.Basecode.Services.ServiceModels.RoomViewModel;

@{
    ViewData["Title"] = "Rooms";
}

@section styles {
    <link rel="stylesheet" href="~/css/roomsCard.css" />
    <link rel="stylesheet" href="~/css/viewRoomCard.css" />
    <link rel="stylesheet" href="~/css/bookingModal.css" />
}

<div class="room-header">
    <h1>Rooms</h1>
    <p>Find Meeting Rooms for your taste and needs.</p>
</div>
<button class="carousel-button left" onclick="moveLeft()">&#10094;</button>
<div class="container-wrapper">
    <div class="container">
        @foreach (var room in Model.roomList)
        {
            <div class="card">
                <div class="card-content" onclick="displayModal('#viewRoomCardModal'); getRoomModalDetails(this, '#viewRoomCardModal', 'GetRoomDetails', 'Rooms')" data-id="@room.RoomId">
                    <h3>@room.RoomName</h3>
                    <img src="@room.Thumbnail" alt="@room.RoomName" class="card-image">
                    <h1>Description</h1>
                    <p>@room.Description</p>
                    <div class="details">
                        <div class="detail-item">
                            <span class="font-weight-bold">Location</span>
                            @*<img src="~/img/Logo1.png" alt="Logo">*@
                            <span>@room.Location</span>
                        </div>
                        <div class="detail-item">
                            <span class="font-weight-bold">Capacity</span>
                            @*@<img src="~/img/Logo1.png" alt="Logo">*@
                            <span>@room.Capacity</span>
                        </div>
                        <div class="detail-item">
                            <span class="font-weight-bold">Equipment</span>
                            @*<img src="~/img/Logo1.png" alt="Logo">*@
                            <span>@room.Equipments</span>
                        </div>
                    </div>
                </div>
                <div class="btn-book">
                    <button type="button" class="book-button" data-toggle="modal" data-target="#createBookingModal" data-id="@room.RoomId" data-name="@room.RoomName">
                        Book
                    </button>
                </div>
            </div>

        }
    </div>
</div>
<button class="carousel-button right" onclick="moveRight()">&#10095;</button>

@Html.Partial("_ViewRoomCardModal")
@Html.Partial("_CreateBookingModal", Model.BookingViewModel)

@section scripts {
    <script>
        $('.book-button').click(function() {
            console.log($('.book-button'))
            let id = $(this).data('id');
            let name = $(this).data('name');

            console.log('clicked', id, name);

            $('#roomId').val(id);
            $('#roomName').val(name);
        })

        let currentPosition = 0;
        const container = document.querySelector('.container');
        const totalCards = @Model.roomList.Count();
        const visibleCards = 3;
        const cardWidth = 310; // 280px card + 30px gap

        function moveLeft() {
            if (currentPosition > 0) {
                currentPosition--;
                updateCarousel();
            }
        }

        function moveRight() {
            if (currentPosition < totalCards - visibleCards) {
                currentPosition++;
                updateCarousel();
            }
        }

        function updateCarousel() {
            container.style.transform = `translateX(-${currentPosition * cardWidth}px)`;
        }
    </script>

    <script>

        // instantiate flatpickr and prevent submission on error found
        $(document).ready(function () {
            $('#createBookingForm').on('submit', function (e) {
                if ($('#errorMessage').text().trim() !== '' ||
                    $('#startDate').val().trim() === '' ||
                    $('#endDate').val().trim() === '') {
                    console.log('hereeeeeeeeeeeeeeee=-=============')
                    e.preventDefault();
                    alert('Please validate the input fields with correct values before submitting the form.');
                }
            });

            const now = new Date();
            var currentHour = now.getHours();
            var currentMinute = Math.ceil(now.getMinutes() / 15) * 15;

            var configStart = {
                enableTime: true,
                dateFormat: "Y-m-d H:i",
                altInput: true,
                altFormat: "F j, Y (h:i K)",
                minuteIncrement: 15,
                minDate: new Date(),
                minTime: `${currentHour}:${currentMinute}`,
                onChange: function (selectedDates, dateStr, instance) {
                    const selectedDate = selectedDates[0];
                    if (selectedDate && selectedDate.toDateString() === now.toDateString()) {
                        instance.set('minTime', `${currentHour}:${currentMinute}`);
                    } else {
                        instance.set('minTime', '00:00');
                    }

                    checkBookingConflict();
                }

            };

            var configEnd = {
                enableTime: true,
                dateFormat: "Y-m-d H:i",
                altInput: true,
                altFormat: "F j, Y (h:i K)",
                minuteIncrement: 15,
                minDate: new Date(),
                minTime: `${currentHour}:${currentMinute}`,
                onChange: function (selectedDates, dateStr, instance) {
                    const selectedDate = selectedDates[0];
                    if (selectedDate && selectedDate.toDateString() === now.toDateString()) {
                        instance.set('minTime', `${currentHour}:${currentMinute}`);
                    } else {
                        instance.set('minTime', '00:00');
                    }

                    checkBookingConflict();
                }

            };

            flatpickr("#startDate", configStart);
            flatpickr("#endDate", configEnd);
        });
    </script>
}
